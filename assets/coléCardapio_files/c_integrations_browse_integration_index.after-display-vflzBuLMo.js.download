!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="46b9ef2c-8be1-3829-b31f-59cdcecea57d")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_stacks_async_add_to_stack","./e_data_modules_stormcrow","./e_edison","./c_spectrum_util_raf_throttle","./c_api_v2_unauthed_client","./c_bem","./c_dotlottie_common_chunk-B7OIQIGJ","./c_chat_chat_constants","./c_src_sink_index","./c_inband-screen_internals_share-modal-share","./c_src_utils_initials","./c_src_bindings_provider","./c_utils_dsx_dsx-react","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_content-member-list_internals_content-member-list","./c_dig-icons_assets_ui-icon_line_folder","./c_dig-components_chip_index","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_line_settings","./c_dig-icons_assets_ui-icon_line_stacks","./e_core_exception","./c_init_data_edison","./c_api_v2_routes_restorations_provider","./c_lodash-es_lodash","./c_hive_schemas_sharing-request_access_user_events","./c_core_notify","react-dom","./c_api_v2_routes_team_insights_provider","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_pap-events_navigation_select_create_folder_action","react/jsx-runtime","metaserver/static/js/langpack","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal","./c_over-quota_utils_use_get_plans","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","./c_growth-components_over-quota-file-viewer-modal","./c_over-quota_utils_oq_price_decrease_helper","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger","./c_react-use_misc_util","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_abuse_fingerprintjs_abuse_fpjs_context","./c_fingerprintjs_fpjs-pro-static_fp","./c_common_components_buttons","./c_contacts_contact","./c_validators","./c_proto_storefront_platform_js_init_data_payment_method_pb","./c_proto_storefront_platform_js_init_data_transition_pb","./c_proto_checkout_js_init_data_checkout_page_pb","./c_cash_common_common_pb","./c_proto_storefront_platform_js_init_data_usage_data_pb","./c_sharing_sharing_pap_logging_send_share_invite_util","./c_dig-components_typeahead_index","./c_dig-icons_assets_ui-icon_line_share","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_common_components_layout","./c_settings-page_internals_settings-page-wrapper","./c_dig-components_tabs_index","./c_dig-components_card_index","./c_components_icons_icon_dropdown_selected","./c_date-fns__lib_requiredArgs_index","./c_dig-icons_assets_ui-icon_line_upsell","./c_user_metadata_api","./c_ui_modal_dig","./c_form","./c_account_email_verify","./c_auth_webauthn","./c_ui_locked-state-modal_open_locked_state_modal","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_ui_contextual-nudge_atoms","./c_dig-icons_assets_ui-icon_line_team","./c_dig-illustrations_spot_bowl-empty","./c_dig-content-icons_icons_folder-shared-default-small","./c_dig-icons_assets_ui-icon_line_external-member"],(function(e,t,a,n,i,r,o,s,l,c,d,u,_,m,g,p,f,h,E,v,b,C,y,S,I,M,x,k,L,w,N,A,T,$,R,O,D,P,F,j,q,B,U,V,H,z,W,Q,G,Y,K,X,J,Z,ee,te,ae,ne,ie,re,oe,se,le,ce,de,ue,_e,me,ge,pe,fe,he,Ee,ve,be,Ce,ye,Se,Ie,Me,xe,ke,Le,we,Ne,Ae,Te,$e){"use strict";function Re(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var Oe=Re(t);a.createApiv2Query({nsClient:i.GetStacksRoutes,rpc:"query_stacks"});const De=a.createApiv2Query({nsClient:a.GetFilesRoutes,rpc:"list_folder"}),Pe=(e,t)=>{De.prefetchQuery(e,{apiArg:{path:t,limit:i.STACK_SIZE_LIMIT}})},Fe=(e,t=!1)=>{const a=De.useQuery({apiArg:{path:e,limit:i.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return Oe.useMemo((()=>{var e;if(a.isLoading)return{isLoading:!0};if(a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const n=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;n.push({file_id:a.id,fq_path:a.name})}return{isError:!1,isLoading:!1,output:n}}}),[a])},je=(e,t=!0)=>{t?a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):a.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},qe=({children:e,onFallback:t,onRequestClose:i})=>{const r=h.useData(),o=Oe.useRef(!1),s=(()=>{const e=n.useIntl();return Oe.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return je(e),!0;default:return a.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return je(e),!0;default:return!1}}),[e])})();return Oe.useEffect((()=>{if("error"===r.status&&!o.current){o.current=!0;s(r)?i():t&&t()}}),[r,t,i,s]),Oe.createElement(Oe.Fragment,null,e)};qe.displayName="DataLoadingErrorWrapper";const Be=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ue,defaultEmitter:Ve}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),r=t(a.Context$6),o=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(r),...a.getTags$7(o),isSm24:"true"},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(r),...a.getProperties$7(o)};e.key===Be&&(a.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:s}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...l}),{eventState:"canceled",key:e.payload.sessionId,tags:s}),a.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:s}))})),He=({children:e,sessionId:t,onRequestClose:n})=>{var i,r;const o=Ue(),{viewer:s,isLoading:l}=a.useViewer(),c=!l&&!1===(null===(i=s.active_user)||void 0===i?void 0:i.is_email_verified);return Oe.default.useEffect((()=>{c&&o.select(Be).emit({sessionId:t})}),[c,t,o]),c?Oe.default.createElement(E.VerifyEmailModal,{viewer:s,user:s.active_user,reason:v.EmailVerificationReasons.SHMODAL,email:null===(r=s.active_user)||void 0===r?void 0:r.email,onShowChange:()=>{s.active_user&&E.ChangeEmail.show(s,s.active_user,v.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{E.EmailVerification.get_for_user(s,s.active_user).email_sent(void 0,v.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):Oe.default.createElement(Oe.default.Fragment,null,e)};He.displayName="EmailVerificationWrapper";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/common/components/hanging-notification.module.out-vflChWqLs.css",(e=>"._hangingNotification_ia43j_3{opacity:0;pointer-events:auto;transform:translateY(-12px);transition:opacity .15s ease-in,transform .15s ease-in}._hangingNotification_ia43j_3._visible_ia43j_14{opacity:1;transform:translateY(0);transition:opacity .2s ease-out,transform .2s ease-out}"));const ze="_hangingNotification_ia43j_3",We="_visible_ia43j_14",Qe={success:a.CheckmarkCircleLine,error:a.FailLine,warning:a.WarningLine},Ge=({isVisible:e,message:t,type:n,action:i,isDismissible:r,onDismiss:o,autoDismissMs:s})=>{const l=n?Qe[n]:null;return Oe.createElement(a.Snackbar$1,{open:e,preferComposition:!0,timeout:s,onRequestClose:o,style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:"var(--dig-radius__large)",borderBottomRightRadius:"var(--dig-radius__large)"}},l&&Oe.createElement(a.Snackbar$1.Accessory,null,Oe.createElement(a.UIIcon,{src:l})),Oe.createElement(a.Snackbar$1.Content,null,Oe.createElement(a.Snackbar$1.Message,null,t),(i||r)&&Oe.createElement(a.Snackbar$1.Actions,null,Oe.createElement(a.Box,{display:"flex",style:{gap:"4px"}},i&&Oe.createElement(a.Button,{variant:"outline",inverse:!0,size:"small",onClick:()=>{try{null==i||i.onClick()}catch(e){}finally{o()}}},i.label),r&&Oe.createElement(a.IconButton,{variant:"outline",inverse:!0,size:"small",onClick:o},Oe.createElement(a.UIIcon,{src:a.CloseLine}))))))};Ge.displayName="NotificationContent";const Ye=({isVisible:e,message:t,type:n,action:i,isDismissible:r,onDismiss:o,autoDismissMs:s=5e3})=>{const l=((e,t)=>{const[a,n]=Oe.useState(e);return Oe.useEffect((()=>{if(e)return void n(!0);const a=window.setTimeout((()=>n(!1)),t);return()=>window.clearTimeout(a)}),[e,t]),a})(e,250),[c,d]=Oe.useState(!1);return Oe.useEffect((()=>{if(!e||!l)return void d(!1);d(!1);const t=requestAnimationFrame((()=>{const e=requestAnimationFrame((()=>{d(!0)}));return()=>cancelAnimationFrame(e)}));return()=>cancelAnimationFrame(t)}),[e,l]),Oe.createElement(a.Box,{left:"0",right:"0",top:"100%",position:"absolute",paddingLeft:"Micro Medium",paddingRight:"Micro Medium",style:{zIndex:-1}},Oe.createElement("div",{className:a.cx(ze,{[We]:c})},Oe.createElement(Ge,{isVisible:e,message:t,type:n,action:i,isDismissible:r,onDismiss:o,autoDismissMs:s})))};Ye.displayName="HangingNotification";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/common/components/mobile-drawer.module.out-vflHjQrar.css",(e=>"._outerWrapper_1lhgo_3{background:var(--dig-color__background__subtle);display:flex;flex-direction:column;height:100%;overflow:hidden}._roundedCorner_1lhgo_11{border-top-left-radius:16px;border-top-right-radius:16px}._container_1lhgo_16{background-color:var(--dig-color__background__base)}._handle_1lhgo_20{background-color:var(--dig-color__border__subtle);border-radius:2px;height:4px;margin:8px auto 0;width:32px}"));const Ke="_outerWrapper_1lhgo_3",Xe="_roundedCorner_1lhgo_11",Je="_container_1lhgo_16",Ze="_handle_1lhgo_20",et=({isOpen:e,onRequestClose:t,isFullHeight:n,shouldShowDrawerHandle:i,children:r,"aria-label":o,"data-testid":s="mobile-drawer"})=>{const l=n?"100%":"auto";return Oe.createElement(a.Drawer.ModalDrawer,{onRequestClose:t,"aria-label":o,isOpen:e,alignment:"bottom",height:l,className:n?void 0:Xe,"data-testid":s,shouldAnimate:!0,hasScrollLock:!0},Oe.createElement(p.FocusLock,{group:"share-modal"},Oe.createElement("div",{className:a.cx(Ke,{[Xe]:!n})},Oe.createElement(a.Drawer.Container,{className:Je},i?Oe.createElement("div",{className:Ze,"data-testid":"drawer-handle"}):void 0,Oe.createElement(a.Drawer.Body,null,r)))))};et.displayName="MobileDrawer";const tt=({children:e,onRequestClose:t})=>{Oe.useEffect((()=>{const e=e=>{"Escape"===e.key&&(e.preventDefault(),e.stopImmediatePropagation(),t())};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}}),[t]);const a=Oe.useCallback((e=>{if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){const t=e.target;t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||t.isContentEditable)||(e.preventDefault(),e.nativeEvent.stopImmediatePropagation())}}),[]);return Oe.createElement(p.FocusLock,{group:"share-modal",autoFocus:!1,returnFocus:!0},Oe.createElement("div",{onKeyDown:a},e))};tt.displayName="ModalFocusWrapper";const at=e=>e.formatMessage({id:"pt0AFj",defaultMessage:"Share folder"}),nt=e=>e.formatMessage({id:"iqba4e",defaultMessage:"Share file"});a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/layout/layout.module.out-vflAITl5Q.css",(e=>"._header_1opo9_2{align-items:center;background-color:var(--dig-color__background__base);border-radius:var(--dig-radius__xxlarge) var(--dig-radius__xxlarge) 0 0;display:flex;justify-content:space-between;padding:0 0 var(--dig-spacing__macro__small)}._headerInfo_1opo9_11{align-items:flex-start;display:flex;flex-direction:row;flex-shrink:0;gap:var(--dig-spacing__micro__small,8px)}._headerText_1opo9_19{flex-direction:column}._headerText_1opo9_19,._title_1opo9_25{display:flex;gap:var(--dig-spacing__micro__xsmall,4px)}._title_1opo9_25{align-items:center;color:var(--dig-color__text__base)}._subtitle_1opo9_32{align-items:flex-start;color:var(--dig-color__text__subtle);display:flex;flex-wrap:wrap;gap:var(--dig-spacing__micro__xsmall,4px)}._headerSlots_1opo9_40{align-items:center;display:flex;flex-shrink:0;gap:var(--dig-spacing__micro__small,8px);justify-content:flex-end}._body_1opo9_49{display:flex;flex:1;flex-direction:column;gap:var(--dig-spacing__macro__small);min-height:0}._bodyRow_1opo9_57{flex-shrink:0}._bodyRow_1opo9_57,._bodyRowScrollable_1opo9_63{display:flex;flex-direction:column}._bodyRowScrollable_1opo9_63{flex:1;min-height:0;overflow-y:auto}._footer_1opo9_72{align-items:center;background-color:var(--dig-color__background__base);display:flex;gap:var(--dig-spacing__micro__small,8px);justify-content:flex-end;padding:var(--dig-spacing__macro__small,24px) 0 0}._footerSecondaryAction_1opo9_81{margin-right:auto}"));const it="_header_1opo9_2",rt="_headerInfo_1opo9_11",ot="_headerText_1opo9_19",st="_title_1opo9_25",lt="_headerSlots_1opo9_40",ct="_body_1opo9_49",dt="_bodyRow_1opo9_57",ut="_bodyRowScrollable_1opo9_63",_t="_footer_1opo9_72",mt="_footerSecondaryAction_1opo9_81",gt=({children:e,scrollable:t=!1})=>Oe.createElement("div",{className:t?ut:dt},e);gt.displayName="Row";const pt=({children:e})=>e?Oe.createElement("div",{"data-testid":"sm26-body",className:ct},e):null;pt.displayName="BodyBase";const ft=Object.assign(pt,{Row:gt}),ht=({icon:e,firstLabel:t,secondLabel:n})=>Oe.createElement(C.Metadata2,{size:"small",withDividers:"bullet"},Oe.createElement(C.Metadata2.Item,null,e&&Oe.createElement(C.Metadata2.UIIcon,{src:e}),Oe.createElement(C.Metadata2.Label,null,Oe.createElement(a.Truncate,{location:.5},t))),n&&Oe.createElement(C.Metadata2.Item,null,Oe.createElement(C.Metadata2.Label,null,n)));ht.displayName="HeaderSubtitle";const Et=({backButton:e,title:t,subtitle:n})=>Oe.createElement("div",{className:rt},e&&Oe.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"large","aria-label":"Back",onClick:e.onClick,"data-testid":"back-button"},Oe.createElement(a.UIIcon,{src:a.ChevronLeftLine})),Oe.createElement("div",{className:ot},Oe.createElement("div",{className:st},Oe.createElement(a.Title,{size:"small",weightVariant:"emphasized"},t)),n&&Oe.createElement(ht,{...n})));Et.displayName="HeaderInfo";const vt=e=>"custom"===e.type?Oe.createElement(Oe.Fragment,null,e.children):Oe.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium","aria-label":e.label,onClick:e.onClick,"data-testid":e.testId},Oe.createElement(a.UIIcon,{src:e.icon}));vt.displayName="Slot";const bt=({info:e,children:t})=>Oe.createElement("div",{"data-testid":"sm26-header",className:it},Oe.createElement(a.Split,{width:"100%"},Oe.createElement(a.Split.Item,null,Oe.createElement(Et,{...e})),Oe.createElement(a.Split.Item,{style:{marginLeft:"auto"}},t&&Oe.createElement("div",{className:lt},t))));bt.displayName="HeaderBase";const Ct=Object.assign(bt,{Slot:vt});var yt;!function(e){e.MAIN="main",e.MORE="more",e.SETTINGS="settings",e.INBAND="inband",e.COPY_LINK="copy_link",e.QR_CODE="qr_code",e.CONTENT_MEMBER_LIST="content_member_list"}(yt||(yt={}));const St={$props:f.atom({isOpen:!1,onRequestClose:()=>{},onControlledFeatureClicked:()=>{},objectIdentifier:{".tag":"file",fileId:""},onObjectIdentifierChanged:()=>Promise.resolve(),isEncrypted:!1,fileName:"",filePath:"",copyLinkMode:"integrated_v1",inbandSharingMode:"integrated_v1",settingsMode:"integrated_v1",transferMode:"controlled_v1",transferHandler:()=>{},canUserUseTransfer:!1,canContentUseTransfer:!1,canUserEnableTransfer:!1,isTransferEligibilityLoading:!1,stacksMode:"controlled_v1",stacksHandler:()=>{},canUserCreateStack:!1,isStacksContentLimitExceeded:null,referrerLoggingMetadata:{actionElement:"",actionSurface:"",contentAction:"share",tiburonOrigin:"SHARING_SDK_SANDBOX",screen:"share_screen",shareModalType:"sm26"},objectLoggingMetadata:{type:"file",name:"",size:0},itemCountResult:{isLoading:!0},objectMetadataResult:{isLoading:!0},onDataSuccess:()=>{},onDataError:()=>{},onDataCancel:()=>{}}),$currentPage:f.atom(yt.MAIN),$previousPage:f.atom(null),$clipboardWriter:f.atom(void 0),$inviteTargets:f.atom([]),$inviteMessage:f.atom(""),$isSuggestionsOpen:f.atom(!1),$suggestedContacts:f.atom([]),$isConfidentialFolderBannerClosed:f.atom(!1),$initialSettingsTab:f.atom("object_settings"),$isOperationInProgress:f.atom(!1),$itemCount:f.atom(null),$fileNameWithoutExtension:f.atom(""),$extension:f.atom(""),$hangingNotification:f.atom(null)},{StoreProvider:It,useStore:Mt}=f.defineStoreProvider((e=>{const t=f.atom(yt.MAIN),n=f.atom(null),i=f.atom(void 0),r=f.atom([]),o=f.atom(""),s=f.atom(!1),l=f.atom([]),c=f.atom(!1),d=f.atom("object_settings"),u=f.atom(!1),_=f.proxy((()=>{const{itemCountResult:t}=e.get();return t.isLoading||t.isError?null:t.itemCount})),m=f.proxy((()=>{const{objectIdentifier:t,fileName:n}=e.get();return"file"===t[".tag"]?a.getFileNameAndExtensionFromFileName(n).fileNameWithoutExtension:""})),g=f.proxy((()=>{const{objectIdentifier:t,fileName:n}=e.get();return"file"===t[".tag"]?a.getFileNameAndExtensionFromFileName(n).extension:""})),p=f.atom(null);return{$props:e,$currentPage:t,$previousPage:n,$clipboardWriter:i,$inviteTargets:r,$inviteMessage:o,$isSuggestionsOpen:s,$suggestedContacts:l,$isConfidentialFolderBannerClosed:c,$initialSettingsTab:d,$isOperationInProgress:u,$itemCount:_,$fileNameWithoutExtension:m,$extension:g,$hangingNotification:p}}),St),xt=e=>{const{objectIdentifier:t}=e,n=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext(),n=null==e?void 0:e.fileId,i="file"===(null==e?void 0:e.type),r=a.getFolderItemCountPackage.useQuery({apiArg:{file_id:null!=n?n:""},pkgArg:{isNonUserRelativeContext:!!t}},{staleTime:3e5,enabled:!i&&!!n});return Oe.useMemo((()=>!r||r.isLoading?{isLoading:!0}:r.isError?{isLoading:!1,isError:!0,error:r.error.appError}:{isLoading:!1,isError:!1,itemCount:r.data.apiData.item_count}),[r])})(t.fileId?{fileId:t.fileId,type:t[".tag"]}:null),i=g.useSharingObjectMetadata(e.objectIdentifier.fileId);return Oe.createElement(It,{itemCountResult:n,objectMetadataResult:i,...e})};xt.displayName="Provider";const kt=(e,t)=>{e.$isOperationInProgress.get()||(t===yt.MAIN&&e.$inviteTargets.set([]),e.$previousPage.set(e.$currentPage.get()),e.$currentPage.set(t))},Lt=e=>{e.$hangingNotification.set(null)},wt=(e,t=5)=>{const a=Math.max(1,Math.floor(t)),n=Math.max(0,Math.floor(e)),i=Math.pow(10,a)-1;return n>i?`${i.toLocaleString()}+`:n.toLocaleString()},Nt=e=>{if(null!==e)return n.intl.formatMessage({id:"u5gsFM",defaultMessage:"{formattedCount} {count, plural, one {item} other {items}}"},{count:e,formattedCount:wt(e)})};function At(e){const t=f.useAtom(e.$itemCount),a=f.useStore(e.$fileNameWithoutExtension),n=f.useStore(e.$extension),{fileName:i,objectIdentifier:r}=f.useAtom(e.$props);return"file"!==r[".tag"]?{icon:y.FolderLine,firstLabel:i,secondLabel:Nt(t)}:{icon:y.FileLine,firstLabel:a,secondLabel:n?n.toLocaleUpperCase():""}}const Tt=()=>{const e=Mt(),t=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{backButton:{onClick:()=>{kt(e,e.$previousPage.get()||yt.MAIN)}},title:(i=n.intl,i.formatMessage({id:"mx8dkN",defaultMessage:"People with access to"})),subtitle:t}}),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement(a.Text,{size:"medium"},"Placeholder for content member list screen"))));var i};Tt.displayName="ContentMemberListPage";const $t=()=>{const e=Mt(),t=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{title:(i=n.intl,i.formatMessage({id:"d32enr",defaultMessage:"Copy link to"})),subtitle:t}}),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement(a.Text,{size:"medium"},"Placeholder for copy link screen"),Oe.createElement("div",{style:{width:"60px"}},Oe.createElement(a.Button,{variant:"transparent",size:"small",onClick:()=>{kt(e,yt.SETTINGS)},"data-testid":"copy-link-manage-button"},"Manage")))));var i};$t.displayName="CopyLinkPage";const Rt=({secondaryAction:e,primaryAction:t})=>Oe.createElement("div",{"data-testid":"sm26-footer",className:_t},e&&Oe.createElement("div",{className:mt},Oe.createElement(a.Button,{variant:"outline",size:"xlarge",onClick:e.onClick,"data-testid":e.testId,withIconStart:e.withIconStart,disabled:e.disabled},e.label)),t&&Oe.createElement(a.Button,{variant:"primary",size:"xlarge",onClick:t.onClick,"data-testid":t.testId,withIconStart:t.withIconStart,disabled:t.disabled},t.label));Rt.displayName="FooterBase";const Ot=Object.assign(Rt,{Action:{}}),Dt=()=>{const e=Mt(),{objectIdentifier:t}=f.useAtom(e.$props),i="file"!==t[".tag"],r=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{backButton:{onClick:()=>{kt(e,yt.MAIN)}},title:i?at(n.intl):nt(n.intl),subtitle:r}},Oe.createElement(Ct.Slot,{type:"custom"},Oe.createElement(Pt,null))),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement(a.Text,null,"Placeholder for inband component"))),Oe.createElement(Ot,{primaryAction:{label:"Share",onClick:()=>{},testId:"inband-share-button",withIconStart:null,disabled:!1}}))};Dt.displayName="InbandPage";const Pt=()=>{const e=Mt();return Oe.createElement(a.Button,{variant:"outline",size:"medium",onClick:()=>kt(e,yt.CONTENT_MEMBER_LIST)},"Facepile")};Pt.displayName="MockContentMemberFacepileButton";a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/pages/main/main.module.out-vflLMlDY5.css",(e=>"._inbandSection_1d338_2{gap:var(--dig-spacing__micro__large)}._inbandSection_1d338_2,._inputSection_1d338_8{display:flex;flex-direction:column}._suggestedChips_1d338_13{align-items:center;display:flex;gap:8px}._memberList_1d338_20{display:flex;flex-direction:column;gap:4px;height:108px}._memberListTitle_1d338_27{color:var(--dig-color__text__subtle);font-size:var(--dig-type__size__text__small);font-style:normal;font-weight:400;line-height:var(--dig-type__lineheight__label__small)}._ownerListing_1d338_35{border-radius:var(--dig-radius__large,12px);height:40px;min-height:40px}._ownerListing_1d338_35,._userInfo_1d338_43{align-items:center;display:flex}._userInfo_1d338_43{flex:1;gap:12px;min-width:0}._permission_1d338_51{align-items:center;background:transparent;border:none;border-radius:var(--dig-radius__large,12px);cursor:pointer;display:flex;gap:4px;height:40px;justify-content:center;padding:4px 10px;transition:background-color .2s}"));const Ft="_inbandSection_1d338_2",jt="_inputSection_1d338_8",qt="_suggestedChips_1d338_13",Bt=e=>{const{handleChipClick:t}=e,n=Mt(),i=f.useAtom(n.$inviteTargets),r=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext(),n=a.sharingTargetsSearchPackage.useQuery({apiArg:{...e},pkgArg:{isNonUserRelativeContext:t}},{staleTime:3e5,retryDelay:e=>Math.min(1e3*2**e,3e4),retry:3});return Oe.useMemo((()=>n.isLoading?{isLoading:!0}:n.error?{isLoading:!1,isError:!0,error:n.error.appError}:n.data&&n.data.apiData?{output:n.data.apiData.entries.map((e=>{if("user"===e[".tag"]){const t=e;return""===t.dbx_account_id?m.createFromEmail(t.name):e}return"group"===e[".tag"]?e:null})).filter((e=>null!=e)),isLoading:!1,isError:!1}:{isLoading:!1,isError:!0,error:{".tag":"other"}}),[n])})(),o=r.isLoading,s=!o,l=s&&r.isError,c=(s&&!l?r.output:[]).filter((e=>!i.find((t=>m.getUniqueId(t)===m.getUniqueId(e))))).slice(0,3),d=o,u=s&&!l&&c.length>0,_=Oe.useCallback((e=>{const t=m.getContactChipDisplayName(e);switch(e[".tag"]){case"email":if(t.length>20){const e=t.split("@")[0],n=t.split("@")[1];return`${a.Emstring.em_snippet(e,10)}@${a.Emstring.em_snippet(n,10)}`}return t;case"user":case"group":return a.Emstring.em_snippet(t,20,.5);default:return t}}),[]);return Oe.createElement("div",{className:qt},d&&Oe.createElement(Ut,{numChips:3}),u&&c.map((e=>Oe.createElement(S.Chip,{key:m.getUniqueId(e),size:"medium",variant:"standard",isSelected:i.includes(e),onClick:()=>t(e),"data-testid":`chip-${m.getUniqueId(e)}`},Oe.createElement(S.Chip.IconAccessory,null,Oe.createElement(a.UIIcon,{src:a.AddLine,size:"small"})),Oe.createElement(S.Chip.Content,null,_(e))))))};Bt.displayName="ContactChips";const Ut=({numChips:e})=>Oe.createElement("div",{"data-testid":"chip-skeleton-row",style:{display:"flex",gap:"8px",alignItems:"center"}},Array.from({length:e}).map(((e,t)=>Oe.createElement(S.Chip,{style:{width:"120px"},key:t,size:"medium",variant:"standard",isSelected:!1,onClick:()=>{},"data-testid":`chip-skeleton-${t}`},Oe.createElement(S.Chip.IconAccessory,null,Oe.createElement(a.UIIcon,{src:a.AddLine,size:"small"})),Oe.createElement(S.Chip.Content,null,Oe.createElement(a.Skeleton.Text,{style:{width:"75px",borderRadius:"15px"},key:t}))))));Ut.displayName="ChipSkeletonRow";const Vt=()=>{const e=Mt(),{objectIdentifier:t,onRequestClose:i,stacksHandler:r,onControlledFeatureClicked:o}=f.useAtom(e.$props),s="file"!==t[".tag"],l=t=>{Lt(e),kt(e,t)},c=()=>{l(yt.INBAND)},d=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{title:s?at(n.intl):nt(n.intl),subtitle:d}},Oe.createElement(Ct.Slot,{type:"iconButton",icon:I.CreateStackLine,label:"Add to stack",onClick:()=>{r(),o()},testId:"header-stacks-page-button"}),Oe.createElement(Ct.Slot,{type:"iconButton",icon:a.MoreHorizontalLine,label:"More ways to share",onClick:()=>l(yt.MORE),testId:"header-more-page-button"}),Oe.createElement(Ct.Slot,{type:"iconButton",icon:M.SettingsLine,label:"Sharing settings",onClick:()=>l(yt.SETTINGS),testId:"header-settings-page-button"})),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement("div",{className:Ft},Oe.createElement("div",{className:jt},Oe.createElement(a.TextInput,{placeholder:"Placeholder inband entry button",onClick:c,onKeyDown:e=>{"Enter"===e.key&&c()},onChange:c,autoFocus:!0,size:"large","data-testid":"email-input"})),Oe.createElement(Bt,{handleChipClick:t=>{e.$inviteTargets.set([t]),l(yt.INBAND)}}))),Oe.createElement(ft.Row,{scrollable:!0},Oe.createElement(a.Text,null," Placeholder for access members list"))),Oe.createElement(Ot,{secondaryAction:{label:"Copy link",onClick:()=>l(yt.COPY_LINK),testId:"main-page-copy-link-button",withIconStart:Oe.createElement(a.UIIcon,{src:a.LinkLine}),disabled:!1},primaryAction:{label:"Done",onClick:i,testId:"main-page-done-button",withIconStart:null,disabled:!1}}))};Vt.displayName="MainPage";const Ht=()=>{const e=Mt(),{onControlledFeatureClicked:t,transferHandler:i}=f.useAtom(e.$props),r=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{backButton:{onClick:()=>{kt(e,yt.MAIN)}},title:(o=n.intl,o.formatMessage({id:"pFWXg8",defaultMessage:"More ways to share"})),subtitle:r}}),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement(a.List,{isSelectable:!0},Oe.createElement(a.List.Item,{onClick:()=>{kt(e,yt.QR_CODE)},"data-testid":"more-qr-code-button"},Oe.createElement(a.List.Accessory,null,Oe.createElement(a.UIIcon,{src:I.QrCodeLine})),Oe.createElement(a.List.Content,null,Oe.createElement(a.Text,{size:"medium"},"Create QR code")),Oe.createElement(a.List.Accessory,null,Oe.createElement(a.UIIcon,{src:a.ChevronRightLine,color:"var(--dig-color__text__subtle)"}))),Oe.createElement(a.List.Item,{onClick:()=>{i(),t()},"data-testid":"more-transfer-button"},Oe.createElement(a.List.Accessory,null,Oe.createElement(a.UIIcon,{src:x.DropboxTransferLine})),Oe.createElement(a.List.Content,null,Oe.createElement(a.Text,{size:"medium"},"Transfer a copy")),Oe.createElement(a.List.Accessory,null,Oe.createElement(a.UIIcon,{src:a.ChevronRightLine,color:"var(--dig-color__text__subtle)"})))))));var o};Ht.displayName="MorePage";const zt=()=>{const e=Mt(),{filePath:t,objectIdentifier:i,onRequestClose:r}=f.useAtom(e.$props),{fileName:o}=f.useAtom(e.$props),s=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{title:(l=n.intl,l.formatMessage({id:"yQ6Q51",defaultMessage:"Create QR code"})),subtitle:s}},Oe.createElement(Ct.Slot,{type:"iconButton",icon:a.CloseLine,label:"Close",onClick:r,testId:"qr-code-page-close-button"})),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement(h.GetQrCode,{objectIdentifier:i,fileName:o,filePath:t,onSettingsClick:()=>{kt(e,yt.SETTINGS)}}))));var l};zt.displayName="QRCodePage";const Wt=()=>{const e=Mt(),{onRequestClose:t}=f.useAtom(e.$props),i=At(e);return Oe.createElement(Oe.Fragment,null,Oe.createElement(Ct,{info:{backButton:{onClick:()=>{kt(e,e.$previousPage.get()||yt.MAIN)}},title:(r=n.intl,r.formatMessage({id:"4eFgJP",defaultMessage:"Settings"})),subtitle:i}},Oe.createElement(Ct.Slot,{type:"iconButton",icon:a.CloseLine,label:"Close",onClick:t,testId:"settings-close-button"})),Oe.createElement(ft,null,Oe.createElement(ft.Row,null,Oe.createElement(a.Text,{size:"medium"},"Placeholder for settings screen"))));var r};Wt.displayName="SettingsPage";a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/share-modal.module.out-vflSDEmYu.css",(e=>"._shareModal_t49ev_3{display:flex;flex-direction:column;max-height:90vh;overflow:hidden;padding:var(--dig-spacing__macro__medium)}._shareModalMobile_t49ev_12{padding:var(--dig-spacing__micro__xlarge) var(--dig-spacing__macro__xsmall) var(--dig-spacing__macro__xsmall)}"));const Qt="_shareModal_t49ev_3",Gt="_shareModalMobile_t49ev_12",Yt=({children:e,onDataSuccess:t,onDataError:i,onDataCancel:r,onRequestClose:o,objectIdentifier:s})=>{const l=g.useSharingObjectMetadata(s.fileId),c=!l.isLoading&&l.isError,d=!l.isLoading&&!l.isError,u=c?l.error:void 0,_=Oe.useRef(!1),m=Oe.useRef(!1),p=Oe.useRef(!1),f=(()=>{const e=n.useIntl();return Oe.useCallback((t=>{switch(t){case"no_access":a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."}));break;case"invalid_oid":a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."}));break;case"email_unverified":a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."}));break;default:a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."}))}}),[e])})();return Oe.useEffect((()=>{d&&!m.current&&(m.current=!0,t())}),[d,t]),Oe.useEffect((()=>{if(c&&!_.current){_.current=!0;const e=null==u?void 0:u[".tag"];f(e),o(),k.reportStack(`Failed to load object metadata for object with id: ${s.fileId}`,{severity:k.SEVERITY.CRITICAL,tags:["sharing","share-modal","sm26-data-loading-error"],exc_extra:{file_id:s.fileId,error:u}}),i()}}),[c,f,s,u,i,o]),Oe.useEffect((()=>()=>{p.current||_.current||m.current||(p.current=!0,r())}),[]),Oe.createElement(Oe.Fragment,null,e)};Yt.displayName="DataLoadingWrapper";const Kt=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Xt,defaultEmitter:Jt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),r=t(a.Context$6),o=t(a.Context$7),s={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(r),...a.getTags$7(o),isSm26:"true"},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(r),...a.getProperties$7(o)};e.key===Kt&&(a.UDCL.logEnd("ops.sm26.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:s}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...l}),{eventState:"canceled",key:e.payload.sessionId,tags:s}),a.UDCL.logEvent("ops.sm26.show_verify_email_modal",{tags:s}))})),Zt=({children:e,sessionId:t,onRequestClose:n})=>{var i,r;const o=Xt(),{viewer:s,isLoading:l}=a.useViewer(),c=!l&&!1===(null===(i=s.active_user)||void 0===i?void 0:i.is_email_verified);return Oe.default.useEffect((()=>{c&&o.select(Kt).emit({sessionId:t})}),[c,t,o]),c?Oe.default.createElement(E.VerifyEmailModal,{viewer:s,user:s.active_user,reason:v.EmailVerificationReasons.SHMODAL,email:null===(r=s.active_user)||void 0===r?void 0:r.email,onShowChange:()=>{s.active_user&&E.ChangeEmail.show(s,s.active_user,v.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{E.EmailVerification.get_for_user(s,s.active_user).email_sent(void 0,v.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):Oe.default.createElement(Oe.default.Fragment,null,e)};Zt.displayName="EmailVerificationWrapper";const ea=()=>{var e,t;const i=n.useIntl(),r=Mt(),o=f.useStore(r.$currentPage),{isOpen:s,onRequestClose:l,objectIdentifier:c}=f.useAtom(r.$props),d=f.useStore(r.$hangingNotification),_=i.formatMessage({id:"U7hqO4",defaultMessage:"Share modal"}),m=Oe.useCallback((()=>{Lt(r)}),[r]),g="sm26_modal",p=g+"-"+a.getContentIdOrPathFromObjectIdentifier(c)+"-"+o,h=a.useCvcInteractiveLogger(g,{shareModalPage:o}),E=Oe.useCallback(h,[h]),{trackedElementRef:v,startCvcMeasurement:b}=a.useComponentVisuallyCompleteCalculator(g,p,E,{reportOnNoChange:!0});Oe.useEffect((()=>{b()}),[b]);const C=u.is_mobile_or_tablet(),y=a.cx(Qt,{[Gt]:C}),S=Oe.createElement(Oe.Fragment,null,Oe.createElement("div",{className:y},(()=>{switch(o){case yt.MAIN:return Oe.createElement(Vt,null);case yt.MORE:return Oe.createElement(Ht,null);case yt.SETTINGS:return Oe.createElement(Wt,null);case yt.INBAND:return Oe.createElement(Dt,null);case yt.COPY_LINK:return Oe.createElement($t,null);case yt.CONTENT_MEMBER_LIST:return Oe.createElement(Tt,null);case yt.QR_CODE:return Oe.createElement(zt,null);default:return Oe.createElement(Vt,null)}})()),Oe.createElement(Ye,{isVisible:null!==d,message:null!==(e=null==d?void 0:d.message)&&void 0!==e?e:"",type:null!==(t=null==d?void 0:d.type)&&void 0!==t?t:"success",action:null==d?void 0:d.action,isDismissible:null==d?void 0:d.isDismissible,onDismiss:m}));if(C){const e=o===yt.SETTINGS,t=o===yt.MAIN;return Oe.createElement(et,{isOpen:s,onRequestClose:l,isFullHeight:e,shouldShowDrawerHandle:t,"aria-label":_,"data-testid":"shareme26-drawer"},Oe.createElement("div",{ref:v},S))}return Oe.createElement(a.Modal,{open:s,onRequestClose:l,width:500,"aria-label":_,"data-testid":"shareme26-modal"},Oe.createElement(tt,{onRequestClose:l},Oe.createElement("div",{ref:v},S)))};ea.displayName="ShareModalWithStore";const ta=e=>{const{isOpen:t,onRequestClose:n}=e,i=p.usePlatform()===p.Platforms.METASERVER,r=Oe.useMemo((()=>Math.random().toString()),[]);return t?i?Oe.createElement(b.ShareBlockingWrapper,{action:a.LockedStateModalAction.SHARE_MODAL,onStatusChange:e=>{e===a.Status.USER_ABORTED_ACTION&&n()}},Oe.createElement(Zt,{sessionId:r,onRequestClose:n},Oe.createElement(Yt,{...e},Oe.createElement(a.ComponentVisuallyCompleteProvider,null,Oe.createElement(xt,{...e},Oe.createElement(ea,null)))))):Oe.createElement(xt,{...e},Oe.createElement(a.ComponentVisuallyCompleteProvider,null,Oe.createElement(ea,null))):null},aa=(e,t)=>{var a;return Oe.createElement(p.SharingSdkProvider,{userApiProps:e.user,origin:null===(a=e.shareModalExtras)||void 0===a?void 0:a.origin,actionInfo:{actionSurface:e.actionSurface}},Oe.createElement(oa,{store:t}))},na=(e,t)=>{var a;return Oe.createElement(p.SharingSdkProvider,{userApiProps:e.user,origin:null===(a=e.shareModalExtras)||void 0===a?void 0:a.origin,actionInfo:{actionSurface:e.actionSurface}},Oe.createElement(ra,{store:t}))},ia=e=>{const t=(e=>f.useInitStore(e,(e=>{const t=f.store(Date.now()),a=f.store(void 0),n=f.store(e.get().isOpen),i=f.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),r=f.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$isOpen:n,$openFlexibleEntryPointTimestamp:t,$dwellFlexibleEntryPointActionTimestamp:a,$anchorRef:i,$overlayPlacement:r,$props:e}})))(e),{variant:n,isLoading:i}=a.useExperimentVariant("sm26_m1");a.useLogExposureOnce("sm26_m1",i);const r=Oe.useRef(!1);return Oe.useEffect((()=>{if(!r.current&&!i){r.current=!0;const i=n===a.Variant.ON?"sm26":"sm24";a.defaultEmitter$3.select(a.ON_ASYNC_SHOW_SHARE_MODAL).emit({...e,...(t=e.fileOrFolder,{fileExtension:t.ext||void 0,isDir:t.is_dir,sharedObjectType:t.is_dir?t.target_ns?"shared_folder":"folder":"file"}),shareModalType:i})}var t}),[e,i,n]),i?null:n===a.Variant.ON?aa(e,t):na(e,t)};ia.displayName="ShareModalBrowse";const ra=({store:e})=>{var t,o,s;const{user:l,fileOrFolder:c,actionSurface:d,actionElement:u,onActionClicked:_}=e.$props.get(),[E,v]=Oe.useState(a.getObjectIdentifier(c)),b=a.getFilename(c),C=c.is_dir,{shareModalExtras:y,sessionId:S,displayType:I}=f.useStore(e.$props),M=null==y?void 0:y.origin,x=f.useStore(e.$isOpen),k=f.useStore(e.$anchorRef),L=f.useStore(e.$overlayPlacement),w=r.useQueryClient();C&&Pe(w,c.file_id);const{variant:N}=a.useExperimentVariant("sharing_lego_settings_page"),A="V1"===N;a.useLogExposureOnce("sharing_lego_settings_page");const T=(e=>Oe.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),$=(e=>Oe.default.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t),e.$isOpen.set(!1)}),[e]))(e),R=Oe.useCallback((async e=>{a.markMilestoneAsCompleted(e,p.ActivationTileMilestoneId.SHARE_CONTENT)}),[]);Oe.useEffect((()=>{(async()=>{if(!E.fileId||""===E.fileId){const e=await g.fetchLegacySharingObjectMetadataObjectIdentifier(E);v(e)}})()}),[E]);const O=Oe.useMemo((()=>c.is_dir?c.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:b,size:c.bytes}),[b,c]),D=Oe.useMemo((()=>({actionSurface:d,actionElement:u,contentAction:"share",tiburonOrigin:M,screen:"share_screen",shareModalType:"sm24"})),[d,u,M]),P=f.useStore(e.$props).onSm24Fallback,{data:F,isLoading:j}=a.useSharingPrefs(),q=null!==(t=null==F?void 0:F.apiData.is_file_transfer_enabled)&&void 0!==t&&t,B=C?i.folderEligibleForTransfer(c):!c.is_cloud_doc,U=l.is_team_admin,V=j,H=!!(null===(s=null===(o=a.useDashAccess().data)||void 0===o?void 0:o.apiData.feature_attributes)||void 0===s?void 0:s.has_stacks_in_fss);let z=null,W=Oe.useMemo((()=>C?null:[{file_id:c.file_id,fq_path:c.fq_path}]),[C,c]);const Q=Fe(c.file_id,C);Q.isLoading||(Q.isError?z="too_many_contents"===Q.error[".tag"]:(W=Q.output,z=!1));const G=a.useShowCopyLinkMiniModalCallback(),Y=Oe.useMemo((()=>"centered"===I?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:k,displayModePositioning:L}),[I,k,L]),K=Oe.useCallback((()=>{var t;const{actionSurface:a,actionElement:n,user:i,shareModalExtras:r,...o}=e.$props.get();"anchored"===o.displayType&&(null===(t=o.onHoverLocked)||void 0===t||t.call(o,{isOpen:!0}));let s=()=>{};const l=new Promise((e=>{s=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":l});navigator.clipboard.write([e])}else l.then((e=>navigator.clipboard.writeText(e)));const d={write:e=>s(e)},u="undefined"!=typeof window&&window.innerWidth<=800?"bottom":L;R(i);const _="anchored"===o.displayType?{isCenteredDisplayed:!1,anchorRef:o.anchorRef,placement:u,yOffsetDistance:5,onHoverLocked:o.onHoverLocked}:{isCenteredDisplayed:!0};G.fn({user:i,filePath:c.file_id,setIsCreatingSharedLink:()=>{},browseFile:c,zIndexOverride:500,actionSurface:a,actionElement:n,origin:null==r?void 0:r.origin,isFromShareMe24Modal:!0,clipboardWriter:d,withLockedStateModal:!1,userActionSource:null==r?void 0:r.userActionSource,..._})}),[e.$props,L,G,R,c]),X=Oe.useCallback((()=>{const e=`sm24_${d}_${u}`,t=[c];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(t,e),userId:l.id})}),[u,d,c,l.id]),J=(e=>Oe.useCallback((t=>{const n=e.$props.get(),i=n.user,r=n.fileOrFolder,o={...n.shareModalExtras,initialScreen:a.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};a.asyncShowShareModal(i,r,o)}),[e]))(e),Z=(e=>{const t=a.useExperimentVariant("sharing_access_management_entry_point_expansion"),n=t.isLoading?"OFF":t.variant;return Oe.useCallback((()=>{const t=e.$props.get(),i=t.user,r=t.fileOrFolder,o={...t.shareModalExtras,initialScreen:a.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};n&&n!==a.Variant.OFF&&a.logExposure({feature:"sharing_access_management_entry_point_expansion",variant:n}),"ON"===n?a.asyncShowAccessManagementBrowse({fileOrFolder:r,user:i,actionSurface:"browse_integration_manage_permissions",actionElement:"access_management",sessionId:Math.random().toString()}):a.asyncShowShareModal(i,r,o)}),[e,n])})(e),ee=Oe.useCallback((async()=>{if(!W)return;const{actionSurface:t}=e.$props.get(),r=la(t),o=C?b:void 0;i.asyncAddToStack(n.intl,w,a.CompatNavigate.navigate,W,r,o)}),[W,b,C,w,e.$props]);return Oe.createElement("div",null,Oe.createElement(He,{sessionId:S,onRequestClose:T},Oe.createElement(p.MetadataProvider,{sharingObjectIdentifier:E,shareModalSessionId:S},Oe.createElement(a.ContextProvider,{context:m.Context,value:S},Oe.createElement(a.ContextProvider,{context:a.Context$4,value:D},Oe.createElement(a.ContextProvider,{context:a.Context$5,value:O},Oe.createElement(h.Provider,{objectIdentifier:E,sessionId:S,objMetadataNewApiVariant:"OFF"},Oe.createElement(sa,{sessionId:S,actionElement:u,actionSurface:d,isDir:C},Oe.createElement(qe,{onFallback:P,onRequestClose:T},Oe.createElement("div",{"data-testid":"shareme24-browse-internals"},Oe.createElement(h.Main,{...Y,isOpen:x,onRequestClose:T,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:K,transferMode:"controlled_v1",transferHandler:X,settingsMode:A?"integrated_v1":"controlled_v1",settingsHandler:J,manageAccessHandler:Z,objectIdentifier:E,isEncrypted:c.is_encrypted,fileName:b,fileSize:c.bytes,filePath:c.fq_path,progressiveInbandVariant:"V4",canUserUseTransfer:q,canContentUseTransfer:B,canUserEnableTransfer:U,isTransferEligibilityLoading:V,referrerLoggingMetadata:D,objectLoggingMetadata:O,onActionClicked:_,onInbandShareCompleted:$,canUserCreateStack:H,isFolderFileCountOverLimit:z,contents:W,createStackHandler:ee,onObjectIdentifierChanged:()=>Promise.resolve()})))))))))))};ra.displayName="ShareMe24BrowseInternals";const oa=({store:e})=>{var t,o,s;const{user:l,fileOrFolder:c,actionSurface:d,actionElement:u,onActionClicked:_,sessionId:h,shareModalExtras:E}=f.useStore(e.$props),[v,b]=Oe.useState(a.getObjectIdentifier(c)),C=a.getFilename(c),y=c.is_dir,S=null==E?void 0:E.origin,I=f.useStore(e.$isOpen),M=Oe.useCallback((()=>{e.$props.get().onRequestClose()}),[e]),x=Oe.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t),e.$isOpen.set(!1)}),[e]);Oe.useEffect((()=>{(async()=>{if(!v.fileId||""===v.fileId){const e=await g.fetchLegacySharingObjectMetadataObjectIdentifier(v);b(e)}})()}),[v]);const k=Oe.useMemo((()=>c.is_dir?c.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:C,size:c.bytes}),[C,c]),L=Oe.useMemo((()=>({actionSurface:d,actionElement:u,contentAction:"share",tiburonOrigin:S,screen:"share_screen",shareModalType:"sm26"})),[d,u,S]),{data:w,isLoading:N}=a.useSharingPrefs(),A=null!==(t=null==w?void 0:w.apiData.is_file_transfer_enabled)&&void 0!==t&&t,T=y?i.folderEligibleForTransfer(c):!c.is_cloud_doc,$=l.is_team_admin,R=N,O=Oe.useCallback((()=>{const e=`sm26_${d}_${u}`,t=[c];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(t,e),userId:l.id})}),[u,d,c,l.id]),D=r.useQueryClient();y&&Pe(D,c.file_id);const P=!!(null===(s=null===(o=a.useDashAccess().data)||void 0===o?void 0:o.apiData.feature_attributes)||void 0===s?void 0:s.has_stacks_in_fss);let F=null,j=Oe.useMemo((()=>y?null:[{file_id:c.file_id,fq_path:c.fq_path}]),[y,c]);const q=Fe(c.file_id,y);q.isLoading||(q.isError?F="too_many_contents"===q.error[".tag"]:(j=q.output,F=!1));const B=Oe.useCallback((async()=>{if(!j)return;const{actionSurface:t}=e.$props.get(),r=la(t),o=y?C:void 0;i.asyncAddToStack(n.intl,D,a.CompatNavigate.navigate,j,r,o)}),[j,C,y,D,e.$props]),U=Oe.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:h,actionElement:u,actionSurface:d,isDir:y,shareModalType:"sm26"})}),[h,u,d,y]),V=Oe.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:h,actionElement:u,actionSurface:d,isDir:y,shareModalType:"sm26"})}),[h,u,d,y]),H=Oe.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:h,actionElement:u,actionSurface:d,isDir:y,shareModalType:"sm26"})}),[h,u,d,y]);return Oe.createElement("div",{"data-testid":"shareme26-browse-internals"},Oe.createElement(p.MetadataProvider,{sharingObjectIdentifier:v,shareModalSessionId:h},Oe.createElement(a.ContextProvider,{context:m.Context,value:h},Oe.createElement(a.ContextProvider,{context:a.Context$4,value:L},Oe.createElement(a.ContextProvider,{context:a.Context$5,value:k},Oe.createElement(ta,{isOpen:I,objectIdentifier:v,onRequestClose:M,onControlledFeatureClicked:_,copyLinkMode:"integrated_v1",inbandSharingMode:"integrated_v1",onInbandShareCompleted:x,shouldResetToMainAfterInbandShare:!1,shouldDisablePostInbandShareHooks:!1,shouldShowBackButtonOnInbandShare:!1,settingsMode:"integrated_v1",shouldResetToMainOnSettingsCancel:!1,shouldResetToMainOnSettingsSave:!1,shouldResetToMainOnUnshareComplete:!1,transferMode:"controlled_v1",transferHandler:O,canUserUseTransfer:A,canContentUseTransfer:T,canUserEnableTransfer:$,isTransferEligibilityLoading:R,stacksMode:"controlled_v1",stacksHandler:B,canUserCreateStack:P,isStacksContentLimitExceeded:F,onObjectIdentifierChanged:()=>Promise.resolve(),isEncrypted:c.is_encrypted,fileName:C,filePath:c.fq_path,referrerLoggingMetadata:L,objectLoggingMetadata:k,onDataSuccess:U,onDataError:V,onDataCancel:H}))))))};oa.displayName="ShareMe26BrowseInternals";const sa=({children:e,sessionId:t,actionElement:n,actionSurface:i,isDir:r})=>{const o=h.useData(),s=Oe.useRef(!1);return Oe.useEffect((()=>{if(!s.current)return"error"===o.status?(s.current=!0,void a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:r,shareModalType:"sm24"})):"loaded"===o.status?(s.current=!0,void a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:r,isSharingBanned:o.accountMetadata.is_sharing_banned,shareModalType:"sm24"})):void 0}),[o.status,t,n,i,r]),Oe.useEffect((()=>()=>{s.current||(s.current=!0,a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:r,shareModalType:"sm24"}))}),[]),Oe.createElement(Oe.Fragment,null,e)};sa.displayName="DataLoadingLogger";const la=e=>{switch(e){case"previews":return"previews";case"search":return"search_results_page";case"quick-view-search":return"search_quick_view";case"browse_screen":return"browse_screen";case"quick-view-browse":return"browse_quick_view";default:return`unknown_${e}`}};e.ShareModalBrowse=ia,e.renderShareMe24=na,e.renderShareMe26=aa}));
//# sourceMappingURL=c_integrations_browse_integration_index.after-display.js-vflnBp_Tb.map

//# debugId=46b9ef2c-8be1-3829-b31f-59cdcecea57d